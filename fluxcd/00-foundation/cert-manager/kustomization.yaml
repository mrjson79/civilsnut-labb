apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  annotations:
    # Cert-manager manifests depend on external-secrets CRDs being available
    flux.weave.works/depends-on: "external-secrets"
    kustomize.toolkit.fluxcd.io/timeout: "10m"

resources:
  - namespace.yaml
  - repository.yaml
  - release.yaml
  - manifests

# Ensure external-secrets CRDs are available before deploying cert-manager manifests
healthChecks:
  - apiVersion: apps/v1
    kind: Deployment
    name: cert-manager
    namespace: cert-manager
  - apiVersion: apps/v1
    kind: Deployment
    name: cert-manager-webhook
    namespace: cert-manager
  - apiVersion: apps/v1
    kind: Deployment
    name: external-secrets
    namespace: external-secrets
  - apiVersion: apiextensions.k8s.io/v1
    kind: CustomResourceDefinition
    name: externalsecrets.external-secrets.io
